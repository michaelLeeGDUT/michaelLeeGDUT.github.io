/*!
 * Chirpy Theme Home Page JavaScript
 * Specific functionality for the home page
 */

// Home page initialization
document.addEventListener('DOMContentLoaded', function() {
    initHomePage();
});

function initHomePage() {
    // Initialize post previews
    initPostPreviews();
    
    // Initialize pagination
    initPagination();
    
    // Initialize trending tags
    initTrendingTags();
    
    // Initialize pin posts functionality
    initPinPosts();
}

// Post preview functionality
function initPostPreviews() {
    const postCards = document.querySelectorAll('.card-wrapper');
    
    postCards.forEach(function(card) {
        // Add hover effects
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
        });
    });
}

// Pagination functionality
function initPagination() {
    const paginationLinks = document.querySelectorAll('.pagination a');
    
    paginationLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            // Add loading state for pagination
            const currentPage = document.querySelector('.pagination .active');
            if (currentPage) {
                currentPage.classList.add('loading');
            }
        });
    });
}

// Trending tags functionality
function initTrendingTags() {
    const tagCloud = document.querySelector('#trending-tags');
    if (!tagCloud) return;
    
    const tags = tagCloud.querySelectorAll('.tag');
    tags.forEach(function(tag) {
        tag.addEventListener('click', function() {
            // Add click animation
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
}

// Pin posts functionality
function initPinPosts() {
    const pinPosts = document.querySelectorAll('.pin');
    
    pinPosts.forEach(function(pin) {
        // Add pin icon animation
        const icon = pin.querySelector('i');
        if (icon) {
            pin.addEventListener('mouseenter', function() {
                icon.style.transform = 'rotate(15deg)';
            });
            
            pin.addEventListener('mouseleave', function() {
                icon.style.transform = 'rotate(0deg)';
            });
        }
    });
}

// Infinite scroll functionality (optional)
function initInfiniteScroll() {
    const postList = document.querySelector('#post-list');
    const pagination = document.querySelector('.pagination');
    
    if (!postList || !pagination) return;
    
    let loading = false;
    
    function loadMorePosts() {
        if (loading) return;
        loading = true;
        
        // Simulate loading more posts
        const nextButton = pagination.querySelector('a[rel="next"]');
        if (nextButton) {
            // In a real implementation, you would fetch the next page via AJAX
            console.log('Loading more posts...');
            
            setTimeout(() => {
                loading = false;
            }, 1000);
        }
    }
    
    // Check if we should load more posts when scrolling
    window.addEventListener('scroll', function() {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
            loadMorePosts();
        }
    });
}

// Search results highlighting
function highlightSearchResults() {
    const searchParams = new URLSearchParams(window.location.search);
    const query = searchParams.get('q');
    
    if (query) {
        const posts = document.querySelectorAll('.post-preview');
        posts.forEach(function(post) {
            const title = post.querySelector('.card-title');
            const content = post.querySelector('.card-text');
            
            if (title) {
                title.innerHTML = highlightText(title.innerHTML, query);
            }
            if (content) {
                content.innerHTML = highlightText(content.innerHTML, query);
            }
        });
    }
}

function highlightText(text, query) {
    if (!query) return text;
    
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
}

// Category and tag filtering
function initFiltering() {
    const filterButtons = document.querySelectorAll('[data-filter]');
    
    filterButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            const filter = this.dataset.filter;
            const posts = document.querySelectorAll('.card-wrapper');
            
            posts.forEach(function(post) {
                if (filter === 'all' || post.classList.contains(filter)) {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
            
            // Update active filter
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

// Initialize all home page features
if (document.querySelector('#post-list')) {
    // Only run home-specific code on pages with post list
    document.addEventListener('DOMContentLoaded', function() {
        highlightSearchResults();
        initFiltering();
        // initInfiniteScroll(); // Uncomment if you want infinite scroll
    });
}

// Export for global access
window.ChirpyHome = {
    initHomePage: initHomePage,
    initPostPreviews: initPostPreviews,
    initPagination: initPagination,
    initTrendingTags: initTrendingTags,
    initPinPosts: initPinPosts,
    highlightSearchResults: highlightSearchResults
};