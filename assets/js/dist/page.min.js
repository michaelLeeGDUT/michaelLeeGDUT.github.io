/*!
 * Chirpy Theme Page JavaScript
 * Functionality for static pages (About, etc.)
 */

// Page initialization
document.addEventListener('DOMContentLoaded', function() {
    initPage();
});

function initPage() {
    // Initialize table of contents for pages
    initPageTOC();
    
    // Initialize image handling
    initPageImages();
    
    // Initialize contact forms
    initContactForms();
    
    // Initialize smooth scrolling
    initSmoothScrolling();
}

// Table of Contents for pages
function initPageTOC() {
    const headings = document.querySelectorAll('.page-content h2, .page-content h3, .page-content h4');
    
    if (headings.length > 2) {
        const toc = document.createElement('div');
        toc.className = 'page-toc';
        toc.innerHTML = '<h4>Table of Contents</h4>';
        
        const tocList = document.createElement('ul');
        
        headings.forEach(function(heading, index) {
            if (!heading.id) {
                heading.id = 'page-heading-' + index;
            }
            
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = '#' + heading.id;
            link.textContent = heading.textContent;
            link.className = 'page-toc-link';
            
            listItem.appendChild(link);
            tocList.appendChild(listItem);
        });
        
        toc.appendChild(tocList);
        
        const content = document.querySelector('.page-content');
        if (content && content.firstElementChild) {
            content.insertBefore(toc, content.firstElementChild);
        }
    }
}

// Image handling for pages
function initPageImages() {
    const images = document.querySelectorAll('.page-content img');
    
    images.forEach(function(img) {
        // Add lazy loading
        if (img.src && !img.loading) {
            img.loading = 'lazy';
        }
        
        // Add click to zoom
        img.addEventListener('click', function() {
            const overlay = document.createElement('div');
            overlay.className = 'image-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                cursor: pointer;
            `;
            
            const enlargedImg = document.createElement('img');
            enlargedImg.src = this.src;
            enlargedImg.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
            `;
            
            overlay.appendChild(enlargedImg);
            document.body.appendChild(overlay);
            
            overlay.addEventListener('click', function() {
                document.body.removeChild(overlay);
            });
        });
        
        img.style.cursor = 'pointer';
    });
}

// Contact form handling
function initContactForms() {
    const contactForm = document.querySelector('#contact-form');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = 'Sending...';
            submitBtn.disabled = true;
            
            // Simulate form submission (replace with actual endpoint)
            setTimeout(function() {
                submitBtn.textContent = 'Sent!';
                submitBtn.style.background = 'green';
                
                setTimeout(function() {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    submitBtn.style.background = '';
                    contactForm.reset();
                }, 3000);
            }, 1000);
        });
    }
}

// Smooth scrolling for anchor links
function initSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(function(anchor) {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Update URL without triggering scroll
                history.pushState(null, null, this.getAttribute('href'));
            }
        });
    });
}

// FAQ functionality
function initFAQ() {
    const faqItems = document.querySelectorAll('.faq-item');
    
    faqItems.forEach(function(item) {
        const question = item.querySelector('.faq-question');
        const answer = item.querySelector('.faq-answer');
        
        if (question && answer) {
            question.addEventListener('click', function() {
                const isOpen = answer.style.display === 'block';
                
                // Close all other FAQ items
                faqItems.forEach(function(otherItem) {
                    const otherAnswer = otherItem.querySelector('.faq-answer');
                    if (otherAnswer) {
                        otherAnswer.style.display = 'none';
                    }
                    otherItem.classList.remove('active');
                });
                
                // Toggle current item
                if (!isOpen) {
                    answer.style.display = 'block';
                    item.classList.add('active');
                }
            });
        }
    });
}

// Timeline functionality
function initTimeline() {
    const timelineItems = document.querySelectorAll('.timeline-item');
    
    function checkTimelineVisibility() {
        timelineItems.forEach(function(item) {
            const rect = item.getBoundingClientRect();
            const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
            
            if (isVisible) {
                item.classList.add('visible');
            }
        });
    }
    
    window.addEventListener('scroll', checkTimelineVisibility);
    checkTimelineVisibility(); // Check on initial load
}

// Portfolio/Gallery functionality
function initPortfolio() {
    const portfolioItems = document.querySelectorAll('.portfolio-item');
    const filterButtons = document.querySelectorAll('.portfolio-filter');
    
    filterButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active filter button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Filter portfolio items
            portfolioItems.forEach(function(item) {
                if (filter === 'all' || item.classList.contains(filter)) {
                    item.style.display = 'block';
                    item.style.opacity = '1';
                } else {
                    item.style.opacity = '0';
                    setTimeout(() => {
                        item.style.display = 'none';
                    }, 300);
                }
            });
        });
    });
}

// Initialize additional page features
document.addEventListener('DOMContentLoaded', function() {
    initFAQ();
    initTimeline();
    initPortfolio();
});

// Export for global access
window.ChirpyPage = {
    initPage: initPage,
    initPageTOC: initPageTOC,
    initPageImages: initPageImages,
    initContactForms: initContactForms,
    initSmoothScrolling: initSmoothScrolling
};